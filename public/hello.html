<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hello World</title>
</head>
<body>
  <h1>Hello World</h1>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
  <script>
    define('iframeContext', [], function(bridge) {
      const self = {
        getInstance: function() {
          return self;
        },
        getResponse: function() {
          return 'This is a response from the iframe context.';
        },
        getState: function() {
          return { status: 'active' };
        },
        oncompleted: function(callback) {
          setTimeout(callback, 1000); // Simulate async completion
        }
      }
      if (bridge) {
        bridge.register(self);
      }
      return self;
    });
  </script>
  <script>
    require(['iframeContext'], function(iframeContext) {
      window.addEventListener('message', function(event) {
        if (!event.data || !event.data.type) return;
        if (event.data.type === 'getInstance') {
          const methods = Object.keys(iframeContext).filter(fn => typeof iframeContext[fn] === 'function');
          event.source.postMessage({ type: 'instance', methods }, event.origin);
        } else if (event.data.type === 'call') {
          const { fnName, args } = event.data;
          let result = null;
          if (typeof iframeContext[fnName] === 'function') {
            result = iframeContext[fnName](...(args || []));
          }
          event.source.postMessage({ type: 'callResult', result }, event.origin);
        }
      });
    });
  </script>
</body>
</html>
